<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Шежіре Онлайн</title>

<!-- Treant.js CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/vendor/perfect-scrollbar.min.css" />

<style>
body { font-family: Arial, sans-serif; background: #f4f6f8; margin:0; padding:0; }
header { background: #1f2937; color: white; padding: 15px; font-size: 22px; text-align: center; font-weight: bold; }
#treeContainer { padding: 20px; overflow:auto; height: 90vh; }
.node { padding: 10px 20px; border-radius: 12px; font-weight: bold; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); cursor: pointer; transition: 0.2s; }
.node:hover { transform: scale(1.05); }
.green { background:#2ecc71; color:white; }
.blue { background:#3498db; color:white; cursor: default; }
button { margin:10px 20px; padding:10px 15px; font-weight:bold; border:none; border-radius:5px; background:#1f2937; color:white; cursor:pointer; }
button:hover { background:#111827; }
</style>
</head>
<body>

<header>Шежіре Онлайн</header>
<div>
<button id="resetBtn">Сбросить дерево</button>
</div>
<div id="treeContainer"></div>

<!-- Treant.js JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/vendor/raphael.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/treant-js/1.0/Treant.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzPSTf_4Tdq4xq8C1pwBYrx33F28MOEYKhwgVFcJ4TP5LYFKhhCaQ8IR44EFkadCW6U/exec";

let people = [];
let treeData = [];
let rootId = null;

async function loadData(){
    const res = await fetch(API_URL);
    people = await res.json();

    // автоматически определяем цвета
    people.forEach(p=>{
        p.hasChildren = people.some(c=>String(c.father_id)===String(p.id));
    });

    const root = people.find(p=>p.father_id===""||p.father_id===null);
    rootId = root.id;

    buildTree(rootId);
}

function buildTree(startId){
    const rootPerson = people.find(p=>String(p.id)===String(startId));

    function createNode(person){
        const children = people.filter(c=>String(c.father_id)===String(person.id));
        const node = {
            text: { name: person.name },
            HTMLclass: person.hasChildren ? "green" : "blue"
        };
        if(children.length>0){
            node.children = children.map(c=>createNode(c));
        }
        return node;
    }

    const tree_config = {
        chart: {
            container: "#treeContainer",
            nodeAlign: "BOTTOM",
            connectors: { type: "step" },
            animation: { nodeAnimation: "easeOutBounce", nodeSpeed: 700, connectorsAnimation: "bounce", connectorsSpeed: 700 }
        },
        nodeStructure: createNode(rootPerson)
    };

    new Treant(tree_config);
}

// кнопка сброса
document.getElementById("resetBtn").onclick=()=>{
    document.getElementById("treeContainer").innerHTML="";
    buildTree(rootId);
}

loadData();
</script>
</body>
</html>
